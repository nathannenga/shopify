angular.module("Pelican",["ngSanitize"]),angular.module("Pelican").controller("ComposeModalController",["$scope","$rootScope","apiService","validator",function(a,b,c,d){function e(d){alertify.log("Saving your new post"),c.addPost(d,a.activeList).then(function(c){c.data.owner=a.user,c.data.preventEmit=f,a.activeList.fromNewList&&(c.data.fromNewList=!0),b.$emit("new post created",c.data),a.closeListModal(),alertify.success("New post created!")}).catch(function(a){console.error(a),alertify.error("Could not save your post :(")})}a.isListModalOpen=!1,a.modalLists=p.lists||[];var f=!1;b.$on("open compose modal",function(b,c){a.isListModalOpen=!0,f=!!c.preventEmit,c.activeList&&(a.activeList=c.activeList)}),b.$on("repin post",function(b,c){a.isListModalOpen=!0,c&&(a.newPost=c)}),a.closeListModal=function(){a.isListModalOpen=!1,a.activeList=null,a.newList=null,a.newPost={},a.query=""},a.backToList=function(){a.activeList=null},a.addList=function(d){return d.title?(d.isPrivate||(d.isPrivate=!1),void c.addList(d.title,d.isPrivate).then(function(c){alertify.success("New list created!"),c.data.fromNewList=!0,c.data.preventEmit=f,a.activateList(c.data),b.$emit("new list created",c.data),a.newList=null}).catch(function(a){console.error(a),alertify.error("Could not save your new list :(")})):alertify.error("Please add a list title to create one.")},a.activateList=function(b){a.activeList=b},a.addPost=function(b){try{d.validateNewPost(a.activeList,b)}catch(a){return alertify.error(a)}if(b.link)try{b.link=d.verifyLink(b.link)}catch(a){return alertify.confirm(b.link+" doesn't seem like a legit URL. Are you sure that's correct?",function(){e(b)},function(){})}e(b)},a.$watch("newPost.link",function(b,e){if(b&&!a.newPost.title){try{var f=d.verifyLink(b)}catch(a){return}c.getHeader(f).then(function(b){b.data&&(a.newPost.title=b.data)}).catch(function(a){console.warn(a)})}})}]),angular.module("Pelican").controller("DiscoverController",["$scope","$rootScope","apiService","validator","trackingService",function(a,b,c,d,e){function f(){return p.posts=p.posts.map(function(a){var b=Math.abs(new Date-new Date(a.metric.created_date))/36e5;return a.trending=a.metric.guestClick/Math.pow(b+2,1.5),a}).sort(function(a,b){return a.trending>b.trending?-1:a.trending<b.trending?1:0}),p.posts}a.init=function(){p.user&&(a.user=p.user||null),p.lists&&(a.lists=p.lists),window.location.href.indexOf("/trending")>-1&&p.posts?a.posts=f():a.posts=p.posts||[]},a.openPost=function(a){b.$emit("open post modal",{post:a})},b.$on("new post created",function(b,c){a.posts.unshift(c)}),b.$on("post edited",function(b,c){for(var d=0;d<a.posts.length;d++)if(a.posts[d]._id===c._id)return void(a.posts[d]=c)}),b.$on("post deleted",function(b,c){a.posts=a.posts.filter(function(a){return a._id!==c._id})}),b.$on("search for post",function(b,c){if(a.posts&&!(a.posts.length<1))for(var d=0;d<a.posts.length;d++)if(a.posts[d]._id===c.postId)return a.openPost(a.posts[d])})}]),angular.module("Pelican").controller("ExtensionController",["$scope","apiService","validator","$rootScope",function(a,b,c,d){function e(){setTimeout(function(){top.window.close()},400)}function f(){var a=window.location.href;return a=a.slice(a.indexOf("?=")),a=a.slice(2,a.length),a=a.replace(/%2F/g,"/")}function g(){var b,c,d=f(),e=d.split("peli-title");e&&e[0]&&(c=e[0]),e&&e[1]&&(b=decodeURIComponent(e[1])),a.newPost||(a.newPost={title:"",link:""}),a.newPost.title=b,a.newPost.link=c}a.init=function(){return p.user?(p.user&&(a.user=p.user),p.lists&&(a.modalLists=p.lists),void g()):a.loginMessage=!0},a.hideX=!0,a.activateList=function(b){a.activeList=b},a.addList=function(c){return c.title?(c.isPrivate||(c.isPrivate=!1),void b.addList(c.title,c.isPrivate).then(function(b){a.activateList(b.data),a.newList=null,a.modalLists.unshift(b.data)}).catch(function(a){console.error(a),alertify.error("Could not save your new list :(")})):alertify.error("Please add a list title to create one.")},a.backToList=function(){a.activeList=null},a.addPost=function(d){try{c.validateNewPost(a.activeList,d)}catch(a){return alertify.error(a)}if(d.link)try{d.link=c.verifyLink(d.link)}catch(a){return alertify.error(a)}b.addPost(d,a.activeList).then(function(b){a.successMessage=!0,e()}).catch(function(a){console.error(a),alertify.error("Could not save your post :(")})}}]),angular.module("Pelican").controller("HeaderController",["$scope","$rootScope","searchService","apiService",function(a,b,c,d){function e(a){var b=0;return a.forEach(function(a){a.viewed||b++}),b}a.init=function(){p.user&&d.getNotifications().then(function(b){a.notifications=b.data,a.activeNotifications=e(b.data)}).catch(function(a){console.error(a)})},a.notificationAction=function(a){d.dismissNotification(a._id),window.location=a.action},a.search=function(a){a&&c.globalSearch(a).then(function(a){console.warn(a.data)}).catch(function(a){console.error(a),alertify.error("There was an error with your search. Sorry!")})},a.$watch("query",function(b,d){return!b&&a.suggestions?a.suggestions=[]:void(!b||b.length<3||c.autoSuggestor(b).then(function(b){a.suggestions=b}).catch(function(a){console.warn(a)}))}),a.activateSuggestion=function(a){"users"===a.type?window.location.href="/user/"+a._id:"lists"===a.type?window.location.href="/list/"+a._id+"/"+a.owner:window.location.href="/user/"+a.owner+"?post="+a._id},a.toggleNotifications=function(){a.notificationsOpened=!a.notificationsOpened,a.notificationsOpened&&d.markNotificationsAsViewed(a.notifications).then(function(b){a.activeNotifications=0}).catch(function(a){console.error(a)})}}]),angular.module("Pelican").controller("ListsController",["$scope","apiService","validator","$rootScope","$timeout","$sce",function(a,b,c,d,e,f){a.init=function(){if(p.user&&(a.user=p.user),p.owner&&(a.owner=p.owner),p.owner&&p.ownerLists?a.lists=p.ownerLists:p.lists&&(a.lists=p.lists),!p.lists||p.lists.length<1)return a.deactivateWelcome=!1;for(var b=0;b<p.lists.length;b++)if(p.lists[b].posts&&p.lists[b].posts.length)return a.deactivateWelcome=!0},a.toggleListLock=function(a){var c="You are about to make this lists private. Are you sure you want to proceed?";a.isPrivate&&(c="You are about to make this list public. Are you sure you want to proceed?"),alertify.confirm(c,function(){b.toggleListPrivate(a).then(function(b){a.isPrivate=!a.isPrivate,d.$emit("list privacy toggled",a),b.data.isNowPrivate?alertify.success("Your list is now private"):alertify.success("Your list is now public")}).catch(function(a){console.error(a),alertify.error("There was a problem with changing your list settings.")})},function(){})},a.deleteList=function(c,e){alertify.confirm("Are you sure you want to delete this list? This action cannot be undone.",function(){b.deleteList(c).then(function(b){alertify.success("Your list was successfully deleted."),d.$emit("list deleted",{list:c,listIndex:e}),a.lists.splice(e,1)}).catch(function(a){console.error(a),alertify.error("There was an error deleting your list.")})})},a.openComposeModal=function(b){var c={user:a.user,lists:a.lists,focusId:"#search-list",preventEmit:!0};b&&(c.preventEmit=!0,c.activeList=b),d.$emit("open compose modal",c)},a.openPost=function(a,b,c){d.$emit("open post modal",{post:a,postIndex:b,listIndex:c})},a.openListSettings=function(a){a.isOpenSettings=!a.isOpenSettings},a.closeListSettings=function(a,b){return a?a.isOpenSettings=!1:void d.$emit("close list settings")},a.openRenameListModal=function(b){a.activeList=angular.copy(b),a.isEditListModalOpen=!0,e(function(){$("#edit-list-name-input").focus()}),a.closeListSettings(null,!0)},d.$on("close editListModal",function(){a.isEditListModalOpen=!1,a.activeList=null}),d.$on("list name updated",function(b,c){a.lists=a.lists.map(function(a){return a._id==c._id&&(a.title=c.title),a})}),d.$on("new post created",function(b,c){c.preventEmit||(a.deactivateWelcome||(a.deactivateWelcome=!0),c.fromNewList||(a.lists=a.lists.map(function(a){return a._id===c.parentList&&a.posts.unshift(c),a})))}),d.$on("new list created",function(b,c){var d=!1;a.lists.forEach(function(a){a._id===c._id&&(d=!0)}),d||a.lists.push(c)}),d.$on("search for post",function(b,c){var d={};a.lists.forEach(function(a,b){a.posts.forEach(function(a,e){a._id===c.postId&&(d.post=a,d.postIndex=e,d.listIndex=b)})}),d.post&&a.openPost(d.post,d.postIndex,d.listIndex)}),d.$on("post edited",function(b,c){a.lists[c.listIndex].posts[c.postIndex]=c}),d.$on("post deleted",function(b,c){a.lists=a.lists.map(function(a){return a._id===c.parentList&&(a.posts=a.posts.filter(function(a){return a._id!=c._id})),a})})}]),angular.module("Pelican").controller("MenuController",["$scope","$sce","$rootScope",function(a,b,c){a.init=function(){p.user&&(a.user=p.user),p.lists&&(a.lists=p.lists),p.owner&&(a.owner=p.owner),p.ownerLists&&(a.ownerLists=p.ownerLists)},a.makeActive=function(b,c){if(c)a.ownerLists=a.ownerLists.map(function(a){return a.displayPosts=!1,a});else{if(a.owner&&a.owner.id!==$scoe.user._id)return;if(window.location.href.indexOf("/discover")>-1)return;if(window.location.href.indexOf("/trending")>-1)return;if(window.location.href.indexOf("/recent")>-1)return;a.lists=a.lists.map(function(a){return a.displayPosts=!1,a})}b.displayPosts=!0},a.sanitizeHtml=function(a){return b.trustAsHtml(a)},a.openPostMenu=function(a,b,d){a.title=a.title.replace(/<\/?span[^>]*>/g,""),c.$emit("open post modal",{post:a,postIndex:b,listIndex:d})},a.openComposeModal=function(b){var d={user:a.user,lists:a.lists,focusId:"#create-list-name",preventEmit:!0};c.$emit("open compose modal",d)},c.$on("post edited",function(b,c){if(c.listIndex&&c.postIndex)return a.lists[c.listIndex].posts[c.postIndex]=c;for(var d=0;d<a.lists.length;d++)if(a.lists[d]._id===c.parentList._id)for(var e=0;e<a.lists[d].posts.length;e++)if(a.lists[d].posts[e]._id===c._id)return void(a.lists[d].posts[e]=c)}),c.$on("new list created",function(b,c){a.lists.push(c)}),c.$on("list name updated",function(b,c){a.lists=a.lists.map(function(a){return a._id==c._id&&(a.title=c.title),a})}),c.$on("list privacy toggled",function(b,c){a.lists=a.lists.map(function(a){return a._id===c._id?c:a})}),c.$on("post deleted",function(b,c){if(c.parentList._id)var d=c.parentList._id;else var d=c.parentList;a.lists=a.lists.map(function(a){return a._id===d&&(a.posts=a.posts.filter(function(a){return a._id!==c._id})),a})}),c.$on("new post created",function(b,c){a.lists=a.lists.map(function(a){return a._id===c.parentList&&a.posts.unshift(c),a})})}]),angular.module("Pelican").controller("OnboardController",["$scope","$rootScope","apiService","$timeout",function(a,b,c,d){a.init=function(){a.active=1},a.next=function(){a.active=a.active+1,3!==a.active||a.activatedClose||(a.activatedClose=!0)},a.previous=function(){a.active=a.active-1},a.goTo=function(b){a.active=b},a.close=function(){a.closed=!0,c.newUserCompleted().then(function(a){}).catch(function(a){console.error(a)}),d(function(){$("#new-user-onboard").remove()},100)},a.openBookMarkLink=function(){window.open("https://chrome.google.com/webstore/detail/pelican-blog/fifejldalccfblmcopgckhdjpjmlkgga","_blank"),a.close()}}]),angular.module("Pelican").controller("PostModalController",["$scope","$rootScope","apiService","trackingService","validator","$timeout",function(a,b,c,d,e,f){function g(b){c.getComments(b).then(function(b){b.data?a.comments=b.data:a.comments=[]}).catch(function(a){console.error(a),alertify.error("Error: ",a.data)})}a.openPost=function(b,c,e){a.activePost=b,a.user=p.user,a.activePost.postIndex=c,a.activePost.listIndex=e,a.activePost.likes&&p.user?a.likedPost=!(a.activePost.likes.indexOf(p.user._id)<0):a.likedPost=!1,$("body").css({overflow:"hidden",marginRight:"15px"}),d.trackConsumedPost(b),g(a.activePost._id)},a.closePostModal=function(){a.activePost=null,a.editingPost=!1,a.comments=[],a.newComment="",$("body").css({overflow:"inherit",marginRight:"0"})},a.repin=function(a){b.$emit("repin post",{text:a.text,link:a.link,title:a.title})},a.removeImg=function(){a.editablePost.img=""},a.updatePost=function(d){try{e.validateNewPost(!0,d)}catch(a){return alertify.error(a)}if(d.link)try{d.link=e.verifyLink(d.link)}catch(a){return alertify.error(a)}c.updatePost(d).then(function(c){a.activePost=c.data,a.editingPost=!1,b.$emit("post edited",a.activePost),alertify.success("Your changes were successfully saved.")}).catch(function(a){console.error(a),alertify.error("Were not able to update post :(")})},a.likePost=function(b){return a.user&&a.user._id?void c.likePost(b).then(function(b){a.likedPost=b.data.isLiked,a.activePost.likes=b.data.likes}).catch(function(a){console.error(a),alertify.error("There was a problem with your request :(")}):alertify.error("Please log in first!")},a.sendComment=function(b){return b?void c.sendComment(b,a.user,a.activePost).then(function(b){a.newComment="",calq.action.track("comment created",{commentId:b.data._id});var c=b.data;c.creator={displayName:p.user.displayName,_id:p.user._id,image:p.user.image},a.comments.push(c)}).catch(function(a){console.error(a),alertify.error("There was a problem with your request :(")}):alertify.error("Please add some text to your comment.")},a.turnOffEditPost=function(){a.editingPost=!1},a.turnOnEditPost=function(b){return a.editingPost?a.turnOffEditPost():(a.editablePost=angular.copy(a.activePost),a.editablePostIndex=b,a.editingPost=!0,void f(function(){$("#post-title-edit").focus()}))},a.deletePost=function(d){alertify.confirm("Are you sure you want to delete this post? This action cannot be undone.",function(){c.deletePost(d).then(function(c){b.$emit("post deleted",d),a.closePostModal(),alertify.success("The post has been deleted.")}).catch(function(a){console.error(a),alertify.error("There was a problem with deleting your post.")})})},b.$on("open post modal",function(b,c){a.openPost(c.post,c.postIndex,c.listIndex)})}]),angular.module("Pelican").controller("RenameListController",["$scope","$rootScope","apiService",function(a,b,c){a.closeEditListModal=function(){b.$emit("close editListModal")},a.renameList=function(d){c.renameList(d).then(function(c){alertify.success("Successfully renamed your list."),b.$emit("list name updated",d),a.closeEditListModal()}).catch(function(a){console.error(a),alertify.error("There was a problem renaming your list.")})}}]),angular.module("Pelican").factory("apiService",["$http",function(a){var b={};return b.addList=function(b,c){return calq.action.track("created list",{userId:p.user._id}),a.post("/api/list",{title:b,isPrivate:c})},b.addPost=function(b,c){var d=b;return d.parentList=c._id,c.isPrivate?d.isPrivate=!0:d.isPrivate=!1,calq.action.track("created post",{userId:p.user._id}),a.post("/api/post",d)},b.updatePost=function(b){return calq.action.track("post updated",{postId:b._id}),a.put("/api/post/"+b._id,b)},b.deletePost=function(b){return calq.action.track("deleted post",{postId:b._id}),a.delete("/api/post/"+b.parentList+"/"+b._id)},b.lazyLoad=function(b){return calq.action.track("lazy loading",{loadAt:b}),a.get("/api/more-posts/"+b)},b.deleteList=function(b){return calq.action.track("deleted list",{listId:b._id}),a.delete("/api/list/"+b._id)},b.renameList=function(b){return calq.action.track("renamed list",{listId:b._id}),a.put("/api/list/rename/"+b._id,b)},b.toggleListPrivate=function(b){return calq.action.track("toggled list private",{listId:b._id,newStatus:!b.isPrivate}),a.put("/api/list/privacy/"+b._id,{newStatus:!b.isPrivate})},b.getHeader=function(b){return calq.action.track("requested page title",{link:b,userId:p.user._id}),a.post("/api/request/header",{uri:b})},b.globalSearch=function(b){return b=encodeURIComponent(b),a.get("/api/global-search/"+b)},b.newUserCompleted=function(){try{calq.action.track("onboard completed",{userId:p.user._id})}catch(a){console.error(a)}return a.put("/api/training/new-user-onboard")},b.likePost=function(b){return calq.action.track("post liked",{postId:b._id}),a.put("/api/like-post/"+b._id)},b.sendComment=function(b,c,d){var e={creator:c._id,postOwner:d.owner._id||d.owner,post:d._id,message:b};return a.post("/api/comment",e)},b.getComments=function(b){return a.get("/api/comments/"+b)},b.getNotifications=function(){return a.get("/api/notifications")},b.dismissNotification=function(b){return calq.action.track("notification dismissed",{notificationId:b}),a.put("/api/dismiss-notification/"+b)},b.markNotificationsAsViewed=function(b){return calq.action.track("opened notifications modal",{userId:p.user._id}),a.put("/api/notifications/viewed",b)},b}]),angular.module("Pelican").factory("searchService",["$http","$q",function(a,b){var c={};return c.globalSearch=function(b){return b=encodeURIComponent(b),a.get("/api/global-search/"+b)},c.autoSuggestor=function(a){var d=b.defer();return c.globalSearch(a).then(function(b){calq.action.track("global search",{query:a,resultCount:b.data.length});var e=[];for(var f in b.data)b.data[f].forEach(function(a){if(a){var b=c.parseSearchData(a,f);e.push(b)}});d.resolve(e)}).catch(function(a){d.reject(a)}),d.promise},c.parseSearchData=function(a,b){if(!b)return console.error("Needs type"),{};var c={type:b,_id:a._id};return"users"===b?(c.image=a.image,c.text=a.displayName,c.email=a.email):"lists"===b?(c.text=a.title,c.owner=a.owner):(c.text=a.title,c.link=a.link,c.subInfo=a.text,c.owner=a.owner),c},c}]),angular.module("Pelican").factory("trackingService",["$http",function(a){var b={};return b.trackConsumedPost=function(b){calq.action.track("consumed post",{postId:b._id}),b.isPrivate||a.put("/api/post-vanity/"+b._id,b)},b}]),angular.module("Pelican").factory("validator",[function(){var a={};return a.validateNewPost=function(a,b){if(!a)throw"Please choose a list before trying to save a new post.";if(!b||!b.title)throw"Please add a name to your post"},a.verifyLink=function(a){a.indexOf("http")<0&&(a="http://"+a);var b=new RegExp(/[-a-zA-Z0-9@:%_\+.~#?&\/\/=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)?/gi),c=a.match(b);if(!c)throw"Please enter a valid URL.";return a},a}]),angular.module("Pelican").directive("sendTo",[function(){return{restrict:"A",link:function(a,b,c){b.bind("click",function(a){c.sendTo&&(window.location=c.sendTo)})}}}]).directive("openLink",["trackingService",function(a){return{restrict:"A",link:function(b,c,d){c.bind("click",function(b){if(d.openLink){var c=JSON.parse(d.openLink);a.trackConsumedPost(c),window.open(c.link,"_blank")}})}}}]).directive("udpateUrl",[function(){return{restrict:"A",link:function(a,b,c){b.bind("click",function(a){return console.log("Altering history disabled for now")})}}}]).directive("identifyLocation",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){d.identifyLocation&&window.location.href.indexOf(d.identifyLocation)>-1&&(c.addClass("active"),b.list&&(b.list.displayPosts=!0),a(function(){if(d.id){var a="#"+d.id.split("menu-")[1],b=$(a);b.length&&($(".list").removeClass("active-list"),b.addClass("active-list"),$("html, body").animate({scrollTop:b.offset().top-60},500))}}))}}}]).directive("menuHelper",["$rootScope",function(a){return{restrict:"A",link:function(a,b,c){var d="#"+c.id.split("menu-")[1];b.bind("click",function(c){var e=$(d);return e.length?void(c.target.className.indexOf("post-title")>-1||c.target.className.indexOf("post")>-1||($(".menu-list").removeClass("active"),b.addClass("active"),$(".list").removeClass("active-list"),e.addClass("active-list"),$("html, body").animate({scrollTop:e.offset().top-60},450))):window.location.href="/list/"+a.list._id+"/"+a.user._id})}}}]).directive("focusId",["$rootScope","$timeout",function(a,b){return{restrict:"A",link:function(c,d,e){a.$on("open compose modal",function(a,d){b(function(){return!c.lists||c.lists.length<1?$("#create-list-name").focus():void $(d.focusId).focus()})})}}}]).directive("looseFocus",["$rootScope",function(a){return{restrict:"A",link:function(a,b,c){$(document).mouseup(function(c){var d=$(b);if(a.list&&a.closeListSettings)a.list.isOpenSettings&&!d.is(c.target)&&(a.closeListSettings(a.list),a.$digest());else if(a.toggleNotifications&&a.notificationsOpened){if($(c.target).hasClass("hn"))return;a.notificationsOpened=!1,a.$digest()}})}}}]).directive("createList",[function(){return{restrict:"A",link:function(a,b,c){$(b).keyup(function(c){13==c.keyCode&&("search-list"===b[0].id?alertify.confirm(a.query+" list does not exist yet, do you want to create it now? It would be a public list.",function(){a.addList({title:a.query})}):a.addList(a.newList))})}}}]).directive("searchPost",[function(){return{restrict:"A",link:function(a,b,c){b.bind("click",function(b){if(a.post&&a.post._id){var c=window.location.origin+window.location.pathname+"?post="+a.post._id;window.history.pushState({path:c},"",c)}})}}}]).directive("resetLocation",[function(){return{restrict:"A",link:function(a,b,c){b.bind("click",function(a){var b=window.location.origin+window.location.pathname;window.history.pushState({path:b},"",b)})}}}]).directive("shouldOpenPost",["$rootScope","$timeout",function(a,b){return{restrict:"A",link:function(c,d,e){if(window.location.search&&window.location.search.indexOf("?=post")){var f=window.location.search.slice(6,window.location.search.length);b(function(){a.$emit("search for post",{postId:f})})}}}}]).directive("resizable",[function(){return{restrict:"A",link:function(a,b,c){var d=.8*$(".menu").height();$("#small-menu").resizable({handles:"n",maxHeight:d,minHeight:250})}}}]).directive("adjustHeight",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){a(function(){function a(a){var b=$(document).scrollTop();e.style.height="2px",e.style.height=a+e.scrollHeight+"px",$(document).scrollTop(b)}var e=c[0];$(window).resize(a),c.bind("keydown",function(b){13===b.keyCode&&a(20)}),c.bind("keyup",function(b){8===b.keyCode&&a(2)}),b.$watch(d.ngModel,function(b,c){if(void 0!==b){var d=b.charAt(b-1);" "!==d&&a(2)}})})}}}]).directive("toggleMenuDown",[function(){return{restrict:"A",link:function(a,b,c){$(b).click(function(a){$("#small-menu").resizable("destroy"),$("#small-menu").removeClass("fadeIn").addClass("toggled-down"),$("#toggle-menu-down").addClass("hidden"),$("#toggle-menu-up").removeClass("hidden")})}}}]).directive("toggleMenuUp",[function(){return{restrict:"A",link:function(a,b,c){$(b).click(function(a){var b=.8*$(".menu").height();$("#small-menu").resizable({handles:"n",maxHeight:b,minHeight:250}),$("#small-menu").removeClass("toggled-down").addClass("fadeIn"),$("#toggle-menu-down").removeClass("hidden"),$("#toggle-menu-up").addClass("hidden")})}}}]).directive("mousewheel",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){a(function(){$(function(){var a=$("#side-menu");a.bind("mousewheel",function(b,c){var d=a.height(),e=a.get(0).scrollHeight;(this.scrollTop>=e-d-100&&c<0||this.scrollTop<1&&c>=0)&&b.preventDefault()})})})}}}]),angular.module("Pelican").directive("escapeSearch",[function(){return{restrict:"A",link:function(a,b,c){$(document).keyup(function(b){27==b.keyCode&&(a.query="",a.$digest())})}}}]).directive("arrowNavigate",[function(){return{restrict:"A",link:function(a,b,c){var d=0;$(b).keydown(function(b){var c=$("#header-search").find(".suggestion");if(c&&!(c.length<1))if(40===b.keyCode){if(d>0&&c.removeClass("active"),$(c[d]).addClass("active"),d>=a.suggestions.length-1)return;d++}else if(38===b.keyCode){if(d>0&&c.removeClass("active"),$(c[d-1]).addClass("active"),d-1===0)return;d--}})}}}]).directive("submitSearch",[function(){return{restrict:"A",link:function(a,b,c){$(b).keydown(function(b){if(13==b.keyCode){var c=$(".suggestion.active")[0];if(!c)return;var d=parseInt($(".suggestion.active")[0].id.replace("suggestion-",""));a.activateSuggestion(a.suggestions[d])}})}}}]),angular.module("Pelican").directive("lazyLoad",["apiService","$timeout",function(a,b){return{restrict:"A",link:function(c,d,e){if(!(window.location.href.indexOf("/discover")<0)){c.fetching=!1;var f=!1;window.onscroll=function(d){if(!f&&window.innerHeight+window.scrollY+1e3>=document.body.offsetHeight){if(c.fetching||!c.posts.length)return;c.fetching=!0,a.lazyLoad(c.posts.length).then(function(a){a.data.length<1&&(f=!0,c.fetching=!1),c.posts=c.posts.concat(a.data),b(function(){c.fetching=!1},1e3)}).catch(function(a){console.error(a)})}}}}}}]),angular.module("Pelican").directive("openSideMenu",[function(){return{restrict:"A",link:function(a,b,c){b.bind("click",function(a){var b=$("#side-menu");b.addClass("animated-fast slideInLeft"),b.css("display","inherit"),setTimeout(function(){b.removeClass("slideInLeft")},300)})}}}]).directive("closeSideMenu",[function(){return{restrict:"A",link:function(a,b,c){windowWidth>600||b.bind("click",function(a){var b=$("#side-menu");b.addClass("slideOutLeft"),setTimeout(function(){b.css("display","none"),b.removeClass("slideOutLeft")},300)})}}}]).directive("openHeaderSearch",[function(){return{restrict:"A",link:function(a,b,c){b.bind("click",function(a){$(".mobile-header").css("display","none"),$(".mobile-close").css("display","inherit"),$("#notification-globe").css("display","none");var b=$("#header-search");b.addClass("animated-fast slideInRight"),b.css("display","inherit"),setTimeout(function(){$("#header-search-input").focus(),b.removeClass("slideInRight")},300)})}}}]).directive("closeHeaderSearch",[function(){return{restrict:"A",link:function(a,b,c){b.bind("click",function(a){$(".mobile-close").css("display","none");var b=$("#header-search");b.addClass("slideOutRight"),setTimeout(function(){b.css("display","none"),$(".mobile-header").css("display","inherit"),$("#notification-globe").css("display","inherit"),b.removeClass("slideOutRight")},300)})}}}]),angular.module("Pelican").directive("submitEnter",["apiService",function(a){return{restrict:"A",link:function(a,b,c){$(b).on("keydown",function(b){if(13==b.keyCode)return b.preventDefault(),a.sendComment(a.newComment)})}}}]),angular.module("Pelican").filter("menuSearch",[function(){var a={input:[],query:"",output:[],count:0};return function(b,c){if(!c)return b;if(a.input==b&&a.query==c){if(0!=a.count)return a.output||b;a.count++}a.input=b,a.query=c,c=c.toLowerCase();var d=[];return b.forEach(function(a){var b=a.title.toLowerCase().indexOf(c);if(b>-1){var e=Object.assign({},a);return 0==b&&1==c.length?e.title='<span style="background-color:yellow; color: #000;">'+c+"</span>"+e.title.slice(1,e.title.length-1):(e.title=e.title.toLowerCase().split(c),e.title=e.title[0]+'<span style="background-color:yellow; color: #000;">'+c+"</span>"+e.title[e.title.length-1]),d.push(e)}var f=Object.assign({},a);if(f.posts=[],a.posts.forEach(function(a){var b=Object.assign({},a),d=a.title.toLowerCase().indexOf(c);return a.title&&d>-1?(0==d&&1==c.length?b.title='<span style="background-color:yellow; color: #000;">'+c+"</span>"+b.title.slice(1,b.title.length-1):(b.title=b.title.toLowerCase().split(c),b.title=b.title[0]+'<span style="background-color:yellow; color: #000;">'+c+"</span>"+b.title[b.title.length-1]),f.posts.push(b)):a.link&&a.link.toLowerCase().indexOf(c)>-1?f.posts.push(a):a.text&&a.text.toLowerCase().indexOf(c)>-1?f.posts.push(a):void 0}),f.posts.length>0)return d.push(f)}),a.output=d,d}}]),angular.module("Pelican").filter("markdown",[function(){var a=new Showdown.converter;return a.makeHtml}]).filter("moment",[function(){return function(a){return moment(a).fromNow()}}]);